<?xml version="1.0" encoding="utf-8"?>
<Patch>

  <!-- Lower bonus from large thrusters -->
	<Operation Class="PatchOperationReplace">
    <xpath>Defs/RitualOutcomeEffectDef[defName="GravshipLaunch"]/comps/li[@Class="RitualOutcomeComp_GravshipFacilities"]/facilityQualityOffsets/li[key="LargeThruster"]/value/text()</xpath>
    <value>0.02</value>
	</Operation>

  <!-- Add a bonus for giant thrusters -->
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/RitualOutcomeEffectDef[defName="GravshipLaunch"]/comps</xpath>
    <value>
      <li Class="RitualOutcomeComp_GravshipFacilities">
        <label>giant thrusters</label>
        <facilityQualityOffsets>
          <li>
            <key>VGE_GiantThruster</key>
            <value>0.03</value>
          </li>
        </facilityQualityOffsets>
      </li>
      <li Class="VanillaGravshipExpanded.RitualOutcomeComp_MannedGravshipFacilities">
        <label>manned copilot console</label>
        <roleId>copilot</roleId>
        <facilitiesPerPawn>1</facilitiesPerPawn>
        <facilityQualityOffsets>
          <li>
            <key>VGE_CopilotConsole</key>
            <value>0.1</value>
          </li>
        </facilityQualityOffsets>
      </li>
    </value>
  </Operation>

  <!-- Make copilot use their console -->
  <Operation Class="PatchOperationAttributeSet">
    <xpath>Defs/RitualBehaviorDef[defName="GravshipLaunch"]/stages/li/roleBehaviors/li[roleId="copilot"]/customPositions/li[@Class="RitualPosition_Copilot"]</xpath>
    <attribute>Class</attribute>
    <value>VanillaGravshipExpanded.RitualPosition_CopilotWithConsole</value>
  </Operation>

  <!-- Replace vanilla ritual obligation with our own, which targets specific consoles only -->
  <Operation Class="PatchOperationReplace">
    <xpath>Defs/RitualObligationTargetFilterDef[defName="GravshipLaunch"]/workerClass/text()</xpath>
    <value>VanillaGravshipExpanded.RitualObligationTargetWorker_GravshipLaunchSpecificConsole</value>
  </Operation>

  <!-- Specify that we're specifically targeting the pilot console -->
  <Operation Class="PatchOperationAdd">
    <xpath>Defs/RitualObligationTargetFilterDef[defName="GravshipLaunch"]</xpath>
    <value>
      <thingDefs>
        <li>PilotConsole</li>
      </thingDefs>
    </value>
  </Operation>

</Patch>